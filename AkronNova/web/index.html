<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#f4b88b">
    <title>AkronNova Live2D</title>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: transparent;
        width: 100%;
        height: 100%;
      }
      #live2d-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <main id="container">
      <canvas id="live2d-canvas" width="400" height="500"></canvas>
      <script src="live2dcubismcore.min.js"></script>
      <script src="live2d.min.js"></script>
      <script type="module">
        // AkronNova Live2D Integration Script
        import { initializeLive2D, loadModel, updateModel, setExpression } from './live2d-core.js';
        
        // If the dedicated Live2D core module is not available, use a basic implementation
        window.addEventListener('load', async () => {
          const canvas = document.getElementById('live2d-canvas');
          if (!canvas) {
            console.error('Canvas element not found.');
            return;
          }

          // Set up basic WebGL context
          const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
          if (!gl) {
            console.error('WebGL context not available.');
            return;
          }

          // Basic placeholder for Live2D functionality
          // In a real implementation, this would load actual model files
          console.log('Live2D system initialized');
          
          // Mock Live2D object for demonstration
          window.AkronNovaLive2D = {
            currentExpression: 0,
            isLoaded: false,
            
            loadModel: function(modelPath) {
              console.log(`Loading Live2D model from: ${modelPath}`);
              // In a real implementation, this would load the actual model
              this.isLoaded = true;
              return Promise.resolve(true);
            },
            
            setExpression: function(expressionIndex) {
              console.log(`Setting expression to index: ${expressionIndex}`);
              this.currentExpression = expressionIndex;
              // In a real implementation, this would update the model's expression
            },
            
            update: function() {
              // In a real implementation, this would update the model animation
            }
          };
          
          // Initialize with default model
          try {
            await window.AkronNovaLive2D.loadModel('models/akronnova_default.model3.json');
            console.log('AkronNova Live2D model loaded successfully');
          } catch (error) {
            console.error('Error loading Live2D model:', error);
          }
          
          // Set up a basic render loop
          function renderLoop() {
            if (window.AkronNovaLive2D.isLoaded) {
              window.AkronNovaLive2D.update();
            }
            requestAnimationFrame(renderLoop);
          }
          
          renderLoop();
        });
        
        // Provide API for emotion control from external sources (like PyQt)
        window.setLive2DEmotion = function(emotionIndex) {
          if (window.AkronNovaLive2D && window.AkronNovaLive2D.setExpression) {
            window.AkronNovaLive2D.setExpression(emotionIndex);
          }
        };
      </script>
    </main>
  </body>
</html>